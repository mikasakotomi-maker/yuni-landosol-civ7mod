# 文明7领袖选择界面图片显示参数整理

## 概述

本模组实现了当选择特定领袖时，显示图片而非3D模型的功能。本文档整理了各个界面中图片显示的各种参数配置，以及如何修改这些参数。

## 核心配置文件

### 1. `ui/shell/leader-select/custom-leader-config.js`

这是主要的配置系统文件，包含了所有图片显示的核心参数。

#### 面板特定的显示配置 (PANEL_DISPLAY_CONFIGS)

```javascript
const PANEL_DISPLAY_CONFIGS = {
    "leader-select": {
        widthMultiplier: 3.5,        // 宽度倍数
        leftOffsetMultiplier: 1.25,  // 左侧偏移倍数
        position: "center"           // 位置
    },
    "age-select": {
        widthMultiplier: 4,         // 时代选择面板中模型可能更小
        leftOffsetMultiplier: 1.5,
        position: "center"
    },
    "civ-select": {
        widthMultiplier: 4,         // 文明选择面板中模型可能更小
        leftOffsetMultiplier: 1.5,
        position: "center"
    },
    "diplomacy-left": {
        widthMultiplier: 2.5,       // 外交界面左侧
        leftOffsetMultiplier: 0.75,
        position: "left"
    },
    "diplomacy-right": {
        widthMultiplier: 2.5,       // 外交界面右侧
        leftOffsetMultiplier: -0.5,
        position: "right"
    }
};
```

#### 测试领袖注册

测试领袖现在通过注册系统进行注册：

```javascript
// 在 leader-overlay-test.js 中
window.CustomLeaderConfig.registerImageLeader(
    "LEADER_YUNI",
    "fs://game/leader-fallback/texture/LEADER_YUNI_NEUTRAL.png",
    {
        widthMultiplier: 3.5,
        leftOffsetMultiplier: 0.5
    }
);
```

#### 注册表配置 (REGISTERED_IMAGE_LEADERS)

用于其他模组注册的图片领袖配置：

```javascript
// 示例注册方式
window.CustomLeaderConfig.registerImageLeader(
    "LEADER_YUNI",  // 领袖ID
    "fs://game/mod_name/textures/LEADER_YUNI.png",  // 图片路径
    {
        widthMultiplier: 3.5,      // 宽度倍数
        leftOffsetMultiplier: 1.25, // 左侧偏移倍数
        position: "center"          // 位置
    }
);
```

## 参数详解

### 核心显示参数

#### 1. widthMultiplier（宽度倍数）
- **类型**: `number`
- **默认值**: 3.5
- **作用**: 控制图片显示区域的宽度相对于容器的倍数
- **计算方式**: `实际宽度 = 容器宽度 × widthMultiplier`
- **示例**:
  - 领袖选择面板: `3.5` (容器宽度的3.5倍)
  - 外交界面: `2.5` (容器宽度的2.5倍)

#### 2. leftOffsetMultiplier（左侧偏移倍数）
- **类型**: `number`
- **默认值**: 1.25
- **作用**: 控制图片在容器中的水平位置偏移
- **计算方式**:
  - 正数: `left = -容器宽度 × leftOffsetMultiplier` (向左偏移)
  - 负数: `left = 容器宽度 × |leftOffsetMultiplier|` (向右偏移)
- **示例**:
  - 领袖选择面板: `1.25` (向左偏移1.25倍容器宽度)
  - 外交左侧: `0.75` (向左偏移0.75倍容器宽度)
  - 外交右侧: `-0.5` (向右偏移0.5倍容器宽度)

#### 3. position（位置）
- **类型**: `string`
- **可选值**: `"left"`, `"center"`, `"right"`
- **默认值**: `"center"`
- **作用**: 指定图片在界面中的对齐方式

### CSS样式参数

在 `leader-overlay-image.js` 中定义的样式参数：

#### 基本样式
```javascript
{
    position: "absolute",           // 定位方式
    top: 0,                        // 顶部对齐
    zIndex: -1,                    // 层级（在文本下方）
    pointerEvents: "none",         // 不响应鼠标事件
    backgroundSize: "100% auto",   // 背景大小：宽度100%，高度自动保持比例
    backgroundRepeat: "no-repeat"  // 不重复
}
```

#### 透明度和动画
```javascript
{
    opacity: 0.8,                  // 透明度
    transform: "scale(1)",         // 缩放
    transition: "none"             // 过渡动画
}
```

#### 外交界面特殊样式
```javascript
{
    position: "fixed",              // 固定定位
    height: "100vh",               // 全屏高度
    backgroundSize: "cover",       // 覆盖整个区域
    opacity: 0,                    // 初始透明
    transform: "scale(0.9)",       // 初始缩放
    transition: "opacity 0.6s ease-out 0.1s, transform 0.6s ease-out 0.1s"
}
```

## 不同界面的参数配置

### 1. 领袖选择面板 (leader-select)

**默认配置**:
```javascript
{
    widthMultiplier: 3.5,
    leftOffsetMultiplier: 1.25,
    position: "center"
}
```

**特点**:
- 使用相对定位
- 图片显示在3D模型区域下方
- 支持响应式调整（窗口大小变化时自动调整）

### 2. 时代选择面板 (age-select)

**默认配置**:
```javascript
{
    widthMultiplier: 4,
    leftOffsetMultiplier: 1.5,
    position: "center"
}
```

### 3. 文明选择面板 (civ-select)

**默认配置**:
```javascript
{
    widthMultiplier: 4,
    leftOffsetMultiplier: 1.5,
    position: "center"
}
```

### 4. 外交界面 (diplomacy)

#### 左侧领袖 (diplomacy-left)
```javascript
{
    widthMultiplier: 2.5,
    leftOffsetMultiplier: 0.75,
    position: "left"
}
```

#### 右侧领袖 (diplomacy-right)
```javascript
{
    widthMultiplier: 2.5,
    leftOffsetMultiplier: -0.5,
    position: "right"
}
```

**特点**:
- 使用固定定位 (fixed)
- 占据屏幕半边 (50vw × 100vh)
- 有淡入动画效果

## 如何修改参数

### 方法1：修改默认面板配置

在 `custom-leader-config.js` 中修改 `PANEL_DISPLAY_CONFIGS`:

```javascript
const PANEL_DISPLAY_CONFIGS = {
    "leader-select": {
        widthMultiplier: 4.0,        // 从3.5改为4.0，更大的显示区域
        leftOffsetMultiplier: 1.0,   // 从1.25改为1.0，减少左偏移
        position: "center"
    },
    // ... 其他面板配置
};
```

### 方法2：注册图片领袖

#### 使用注册法（推荐）:
```javascript
// 在模组的初始化代码中
window.CustomLeaderConfig.registerImageLeader(
    "LEADER_YUNI",
    "fs://game/leader-fallback/texture/LEADER_YUNI_NEUTRAL.png"
);
```
注意：偏移量、宽度倍数等显示参数由面板配置（`PANEL_DISPLAY_CONFIGS`）控制，不需要在注册时指定。这样可以确保不同面板中的显示效果一致。

#### 使用注册API（推荐用于正式模组）:
```javascript
// 在其他模组中调用
window.CustomLeaderConfig.registerImageLeader(
    "LEADER_YUNI",
    "fs://game/your_mod/textures/LEADER_YUNI.png",
    {
        widthMultiplier: 3.0,       // 更小的显示区域
        leftOffsetMultiplier: 1.5,  // 更大的左偏移
        position: "center"
    }
);
```

### 方法3：修改CSS样式参数

在 `leader-overlay-image.js` 中修改样式参数：

#### 修改透明度:
```javascript
opacity: 0.6,  // 从0.8改为0.6，更透明
```

#### 修改动画效果:
```javascript
transition: "opacity 0.3s ease-out, transform 0.3s ease-out",  // 更快的动画
```

#### 修改缩放:
```javascript
transform: "scale(0.95)",  // 从scale(0.9)改为scale(0.95)
```

## 图片路径配置

### 支持的路径格式

1. **模组内路径**:
   ```
   fs://game/mod_name/textures/LEADER_IMAGE.png
   ```

2. **绝对路径**:
   ```
   /path/to/your/image.png
   ```

3. **相对路径**:
   ```
   ./textures/LEADER_IMAGE.png
   ```

### 图片文件存放位置

建议将图片文件放在模组的 `texture/` 目录下：

```
your_mod/
├── texture/
│   ├── LEADER_YUNI.png
│   ├── LEADER_ANOTHER.png
│   └── ...
└── ui/
    └── ...
```

## 调试和测试

### 开启调试日志

打开浏览器开发者工具 (F12)，查看控制台中的日志：

- `CustomLeaderConfig: ...` - 配置系统日志
- `Leader Overlay Image: ...` - 图片覆盖层日志
- `Leader Select Panel Override: ...` - 面板重写日志

### 测试参数修改

1. 修改配置文件中的参数
2. 重新加载游戏或模组
3. 选择对应的领袖查看效果
4. 根据需要调整参数

### 常用调试技巧

1. **检查容器尺寸**:
   ```javascript
   const container = getContainer(context);
   console.log("Container size:", container.getBoundingClientRect());
   ```

2. **检查覆盖层位置**:
   ```javascript
   const overlay = container.querySelector(".leader-overlay-image-block");
   console.log("Overlay position:", overlay.getBoundingClientRect());
   ```

3. **验证配置加载**:
   ```javascript
   console.log("Display config:", window.CustomLeaderConfig.getImageDisplayConfig("LEADER_YUNI"));
   ```

## 高级配置

### 响应式调整

图片覆盖层支持自动响应容器大小变化：

```javascript
// 在窗口大小改变时自动调整
const resizeObserver = new ResizeObserver(() => {
    updateOverlayPositionAndSize(overlayBlock, container, config);
});
resizeObserver.observe(container);
```

### 多面板适配

系统会根据当前激活的面板自动选择合适的配置：

```javascript
const panelType = window.CustomLeaderConfig.detectCurrentPanel();
const config = window.CustomLeaderConfig.getImageDisplayConfig(leaderID, panelType);
```

### 状态映射（预留接口）

外交界面支持根据领袖状态调整显示（预留功能）：

```javascript
// 将来可以根据领袖情绪状态选择不同的图片
const state = getLeaderStateFromSequence(playerID, sequenceType, position, context);
// 可能的返回值: "neutral", "hostile", "war", "listening", "waiting", "happy", "angry"
```

## 故障排除

### 常见问题

1. **图片不显示**
   - 检查图片路径是否正确
   - 确认图片文件存在且可访问
   - 检查容器元素是否正确获取

2. **图片位置不对**
   - 调整 `leftOffsetMultiplier` 参数
   - 检查 `position` 参数设置
   - 验证容器尺寸计算

3. **图片大小不合适**
   - 修改 `widthMultiplier` 参数
   - 确保图片分辨率合适
   - 检查 `backgroundSize` 设置

4. **动画效果异常**
   - 检查 `transition` CSS属性
   - 验证 `opacity` 和 `transform` 值
   - 确认动画时序设置

### 性能优化建议

1. 使用适当的图片分辨率（建议 1024x1024 或 2048x2048）
2. 避免过大的 `widthMultiplier` 值
3. 合理设置动画时长
4. 及时清理不需要的覆盖层

## 扩展开发

### 添加新面板支持

1. 在 `PANEL_DISPLAY_CONFIGS` 中添加新面板配置
2. 实现对应的面板检测逻辑
3. 更新 `detectCurrentPanel()` 函数

### 实现状态映射

1. 完善 `getLeaderStateFromSequence()` 函数
2. 根据状态选择不同的图片或配置
3. 更新图片路径获取逻辑

### 支持更多图片格式

目前支持PNG格式，可以扩展支持其他格式：
- JPG/JPEG
- WebP
- GIF（静态）

---

*本文档基于模组版本的分析整理，实际参数可能因版本更新而有所变化。*
